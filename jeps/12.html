<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=us-ascii" /><meta http-equiv="Content-Type" content="text/html; charset=us-ascii" /><title>JEP 12: Preview Language and VM Features</title><link rel="shortcut icon" href="/images/nanoduke.ico" /><link rel="stylesheet" type="text/css" href="/page.css" /><script type="text/javascript" src="/page.js"><noscript></noscript></script><style type="text/css" xml:space="preserve">
      TABLE { border-collapse: collapse; padding: 0px; margin: 1em 0; }
      TR:first-child TH, TR:first-child TD { padding-top: 0; }
      TH, TD { padding: 0px; padding-top: .5ex; vertical-align: baseline; text-align: left; }
      TD + TD, TH + TH { padding-left: 1em; }
      TD:first-child, TH:first-child, TD.jep { text-align: right; }
      TABLE.head TD:first-child { font-style: italic; padding-left: 2em; }
      PRE { padding-left: 2em; margin: 1ex 0; font-size: inherit; }
      TABLE PRE { padding-left: 0; margin: 0; }
      TABLE.jeps TD:first-child + TD,
      TABLE.jeps TD:first-child + TD + TD { padding-left: .5em; }
      TABLE.jeps TD:first-child,
      TABLE.jeps TD:first-child + TD,
      TABLE.jeps TD:first-child + TD + TD { font-size: smaller; }
      TABLE.jeps TD.cl { font-size: smaller; padding-right: 0; text-align: right; }
      TABLE.jeps TD.cm { font-size: smaller; padding-left: .1em; padding-right: .1em; }
      TABLE.jeps TD.cr { font-size: smaller; padding-left: 0; }
      TABLE.jeps TD.z { padding-left: 0; padding-right: 0; }
      TABLE.head TD { padding-top: 0; }
      .withdrawn { text-decoration: line-through; }
    </style></head><body><div id="main"><h1>JEP 12: Preview Language and VM Features</h1><table class="head"><tr><td>Owner</td><td>Alex Buckley</td></tr><tr><td>Type</td><td>Informational</td></tr><tr><td>Scope</td><td>SE</td></tr><tr><td>Status</td><td>Active</td></tr><tr><td>Discussion</td><td>jdk dash dev at openjdk dot java dot net</td></tr><tr><td>Effort</td><td>M</td></tr><tr><td>Duration</td><td>M</td></tr><tr><td>Reviewed by</td><td>Alan Bateman, Brian Goetz, Mark Reinhold</td></tr><tr><td>Endorsed by</td><td>Mark Reinhold</td></tr><tr><td>Created</td><td>2018/01/19 01:27</td></tr><tr><td>Updated</td><td>2019/11/08 18:22</td></tr><tr><td>Issue</td><td><a href="https://bugs.openjdk.java.net/browse/JDK-8195734">8195734</a></td></tr></table><div class="markdown"><h2 id="Summary">Summary</h2>
<p>A preview language or VM feature is a new feature of the Java SE Platform that is fully specified, fully implemented, and yet impermanent. It is available in a JDK feature release to provoke developer feedback based on real world use; this may lead to it becoming permanent in a future Java SE Platform.</p>
<h2 id="Goals">Goals</h2>
<ul>
<li>
<p>Define a model for partitioning new language and VM features based on whether they are permanent or impermanent in the Java SE Platform (that is, whether they will exist in the same form for all future releases, or will exist in a different form or not at all).</p>
</li>
<li>
<p>Communicate the intent that code which uses preview language and VM features from an older release of the Java SE Platform will not necessarily compile or run on a newer release.</p>
</li>
<li>
<p>Outline the relationship between preview language and VM features on the one hand, and Java SE and JDK APIs on the other hand.</p>
</li>
</ul>
<h2 id="Non-Goals">Non-Goals</h2>
<ul>
<li>
<p>It is not necessary for all new language and VM features to be available initially as preview features.</p>
</li>
<li>
<p>It is not necessary for this JEP to mandate specific mechanisms for collecting and evaluating developer feedback about preview language and VM features.</p>
</li>
<li>
<p>Nothing in this JEP should be interpreted as encouraging or allowing fragmentation of the Java SE Platform.</p>
</li>
</ul>
<h2 id="Motivation">Motivation</h2>
<p>The Java SE Platform has global reach, so the cost of a mistake in the design of a Java language or VM feature is high. ("VM feature" encompasses the class file format and the JVM bytecode instruction set.) A mistake may be a hard technical error (such as a flaw in the type system), a soft usability problem (such as a surprising interaction with an older feature), or a poor architectural choice (such as one that forecloses on directions for future features).</p>
<p>To build confidence in the correctness and completeness of a new language or VM feature, it is desirable for the feature to enjoy a period of broad exposure <em>after</em> its specification and implementation are stable but <em>before</em> it achieves final and permanent status in the Java SE Platform. To achieve the broadest possible exposure, and to maximize the likelihood of swift feedback, the feature may be included in a <a href="//openjdk.java.net/projects/jdk/">JDK feature release</a> on a <em>preview</em> basis. Previewing a feature in the JDK will encourage tool vendors to build good support for the feature before the bulk of Java developers use it in production.</p>
<p>Over the six-month course of the JDK feature release, and perhaps the following release too, the feature's "real world" strengths and weaknesses will be evaluated to decide if it has a long-term role in the Java SE Platform. Ultimately, the feature will either be granted final and permanent status (with or without refinements) or be removed.</p>
<h2 id="Description">Description</h2>
<h3 id="Design-of-a-Preview-Feature">Design of a Preview Feature</h3>
<p>A <em>preview language or VM feature</em> is a new feature whose design, specification, and implementation are all complete, but which would benefit from a period of broad exposure and evaluation before either achieving final and permanent status in the Java SE Platform or else being refined or removed.</p>
<p>The key properties of a preview language or VM feature are:</p>
<ol>
<li>
<p><em>High quality.</em> A preview feature must display the same level of technical excellence and finesse as a final and permanent feature of the Java SE Platform. For example, a preview feature must respect traditional Java principles such as readability and compatibility, and it must receive appropriate treatment in the reflective and debugging APIs of the Java SE Platform. As a general rule, for anything not explicitly spelled out in this JEP, the policy is "No different for a preview feature than for a final and permanent feature."</p>
</li>
<li>
<p><em>Not experimental.</em> A language or VM feature that is considered experimental, risky, incomplete, or unstable must not be previewed in a JDK feature release. An experimental feature must be iterated and stabilized in its own project, which in turn produces binaries that are clearly distinguished from binaries of the <a href="//openjdk.java.net/projects/jdk/">JDK Project</a>. For the purpose of comparison, if an experimental feature is considered 25% "done", then a preview feature should be at least 95% "done". To make a further comparison, the level of completeness and stability expected for a preview language or VM feature is considerably higher than the level expected for an <a href="//openjdk.java.net/jeps/11#Goals">incubating API</a>.</p>
</li>
<li>
<p><em>Universally available.</em> The Umbrella JSR for the Java SE $N Platform enumerates the preview features in the platform. The desire for feedback and the expectation of quality means that these features are not "optional"; they must all be supported in full by every implementation of the Umbrella JSR. They are specified in appendices of the Java SE $N Editions of the Java Language Specification (JLS) and the Java Virtual Machine Specification (JVMS). The Java Compatibility Kit for Java SE $N checks conformance of an implementation's preview features to the appropriate appendix.</p>
</li>
</ol>
<p>This JEP does not constrain the shape of a preview feature. A preview language feature may add declaration, statement, expression, and literal forms to the syntax of the Java language; it may modify the static semantics (typing) of pre-existing declarations, statements, expressions, and literals; and it may modify the dynamic semantics (execution) of statements or expressions. A preview VM feature may make additions and modifications of a similar nature to the class file format and the bytecode instruction set. Unlike incubating APIs, which have their own <code>jdk.incubator</code> namespace for packages and modules, there is no requirement that a preview language or VM feature adopts a striking syntactic form to denote that the feature is available on a preview basis.</p>
<p>As a potential example of a preview feature, consider the changing role of the <code>_</code> character. It was <a href="//mail.openjdk.java.net/pipermail/lambda-dev/2013-July/010670.html">redefined from an identifier to a keyword</a> in order to reserve it for future language features. To provide a migration period for existing code, the redefinition was spread over two JDK releases: in JDK 8, the use of <code>_</code> as an identifier caused <code>javac</code> to give a warning, while in JDK 9, it caused an error. In the regime described by this JEP, Java SE 8 would specify a preview language feature that defines <code>_</code> as a keyword. <code>javac</code> in JDK 8 would give a warning for the use of <code>_</code> as an identifier, unless preview features are enabled, in which case <code>javac</code> would give an error. Subsequently, Java SE 9 would specify the definition of <code>_</code> as a keyword on a final and permanent basis, so <code>javac</code> in JDK 9 would always give an error for the use of <code>_</code> as an identifier, even when preview features are not enabled.</p>
<h3 id="Use-of-Preview-Features">Use of Preview Features</h3>
<p>Because preview language and VM features have not achieved final and permanent status in the Java SE Platform, they are unavailable by default at compile time and run time. Developers who wish to use preview language features in their programs must explicitly enable them in the compiler and the runtime system. That is, developers must "opt in" twice: once at compile time, when Java source code uses preview language features, and again at run time, when the corresponding class files are executed. These class files are special; they should not be distributed beyond the control of the developer who chose to use preview language features.</p>
<p>In order to allow the runtime system to detect when "opt in" is necessary, compilers must emit class files which (i) memorialize the use of preview language features by the original source code, and (ii) record the use of preview VM features in the constant pool entries and attributes of the class files. In more detail:</p>
<ul>
<li>
<p>If Java source code uses a preview language feature of Java SE $N, then a Java compiler must record that the emitted class file <em>depends on the preview VM features of Java SE $N</em>. This applies even if the preview language feature is "syntactic sugar", i.e., it can be compiled without relying on preview VM features (such as novel class file constructs).</p>
</li>
<li>
<p>If a compiler (Java or non-Java) emits a class file which uses a preview VM feature of Java SE $N, then the compiler must record that the emitted class file <em>depends on the preview VM features of Java SE $N</em>. For a Java compiler, this requirement applies even if the Java source code uses no preview language features, because a Java compiler may choose to implement a final and permanent language feature by translation to a preview VM feature.</p>
</li>
</ul>
<p>A class file denotes that it <em>depends on the preview VM features of Java SE $N</em> by having a <code>major_version</code> item that corresponds to Java SE $N and a <code>minor_version</code> item that has all 16 bits set. For example, a class file that depends on the preview VM features of Java SE 13 would have version 57.65535.</p>
<blockquote>
<p>Using <code>minor_version</code> is preferred to <code>access_flags</code>, which is already very busy insofar as every bit is allocated to a flag when viewing the union of <code>access_flags</code> across the <code>ClassFile</code>, <code>field_info</code>, and <code>method_info</code> structures. Unused bits in any one structure are best left for use by actual features.</p>
</blockquote>
<blockquote>
<p>Using <code>minor_version</code> is also preferred to a custom attribute or a special constant pool entry because the VM's processing of the constant pool may depend on whether preview features are enabled, and those constructs would be read too late.</p>
</blockquote>
<blockquote>
<p>The unsubtle bit pattern in <code>minor_version</code> is deliberately chosen in preference to an individual bit. We wish to avoid well-meaning but ultimately misguided guesses at future roles, and therefore bit patterns, for the item. We also wish to avoid the particular confusion around the lowest bit: if a Java SE 13 class file with preview content had version 57.1, it would be easy to interpret incorrectly as the "next" version after 57.0.</p>
</blockquote>
<p>A JVM implementation for Java SE $N must not define a class file that depends on the preview VM features of a different Java SE release, even if the JVM implementation would otherwise understand the class file's version. Specifically, <code>ClassLoader.defineClass</code> must fail for the bytes of the class file. This prevents the class files from running years into the future, long after the preview language features that were enjoyed by the developer have been removed or finalized in a different form. In essence, Java SE $N+1 does not claim backwards compatibility with the preview features of Java SE $N.</p>
<p>If preview language features are not enabled at compile time, developers should not expect the compiler to compile source code which uses preview language features of <em>any</em> Java SE release, or to compile source code against class files which depend on preview VM features of <em>any</em> Java SE release. Similarly, if preview VM features are not enabled at run time, a JVM implementation will not load a class file that depends on the preview VM features of <em>any</em> Java SE release.</p>
<h3 id="Example-use-of-preview-features">Example use of preview features</h3>
<p>This JEP mandates the presence of a mechanism to enable preview features, which are otherwise disabled. This JEP also forbids the mechanism from enabling preview features on an individual basis, because all preview features have equal status in the Java SE Platform.</p>
<p>This JEP does not, however, specify an actual mechanism. Therefore, to aid understanding, this section outlines a possible mechanism for enabling preview features in the command-line tools of the JDK: <code>javac</code>, <code>java</code>, <code>javadoc</code>, <code>jshell</code>, and possibly <code>jlink</code>. The mechanism is a single command-line flag, <code>--enable-preview</code>.</p>
<p><strong>Compile time</strong></p>
<p><code>javac</code> in JDK $N accepts the <code>--enable-preview</code> flag only in combination with <code>--release $N</code> or <code>-source $N</code>. (For brevity, only <code>--release</code> is mentioned in the rest of this JEP.)</p>
<blockquote>
<p>The meaning of <code>--enable-preview</code> changes from one JDK to the next. Requiring the developer to spell out a concrete version number with <code>--release</code> sets the expectation that code relies on the preview features found specifically in JDK $N, and may not compile in future if JDK $N+1 has different preview features.</p>
</blockquote>
<blockquote>
<p><code>--enable-preview</code> itself does not take a version number because it would be easy to misinterpret. For a developer using JDK 13, the flag <code>--enable-preview 14</code> appears to suggest a commitment of what JDK 14 will contain, but no such commitment is possible.</p>
</blockquote>
<p>There is no expectation that <code>javac</code> in JDK $N will understand preview features from JDK $N-1 or any other prior release. For example, it would be costly for JDK 13 to support preview features from JDK 12 which were changed or dropped in response to feedback. Consequently, <code>--enable-preview</code> is illegal if the operand to <code>--release</code> is not $N.</p>
<p>On JDK 13:</p>
<pre><code>javac Foo.java                                // Do not enable any preview features
javac --release 13 --enable-preview Foo.java  // Enable all preview features of Java SE 13
javac --release 12 --enable-preview Foo.java  // DISALLOWED</code></pre>
<p>On JDK 14:</p>
<pre><code>javac Foo.java                                // Do not enable any preview features
javac --release 14 --enable-preview Foo.java  // Enable all preview features of Java SE 14
javac --release 13 --enable-preview Foo.java  // DISALLOWED</code></pre>
<p>When the preview language features of Java SE $N are enabled (<code>--release $N --enable-preview</code>):</p>
<ul>
<li>
<p>$N must be the Java SE Platform release implemented by the JDK containing the compiler. Only a compiler in JDK $N may support the preview language features defined by Java SE $N, even if the compiler habitually supports the final and permanent features defined by Java SE $N-1 and other prior releases. Developers should not expect <code>javac</code> in JDK $N to compile source code which uses preview language features of other Java SE releases, or to compile source code against class files which depend on preview VM features (see below) of other Java SE releases.</p>
</li>
<li>
<p>If a compile-time error occurs due to the incorrect use of a preview language feature of Java SE $N, then <code>javac</code> may indicate that the error is associated specifically with a preview language feature. (This helps to highlight that the feature, as well as the compile-time errors associated with it, may vary in future Java SE releases.)</p>
</li>
<li>
<p>Every <code>class</code> file emitted by <code>javac</code> <em>depends on the preview VM features of Java SE $N</em>, regardless of whether the source code corresponding to the <code>class</code> file actually uses preview language features of Java SE $N.</p>
</li>
<li>
<p>If a preview language feature of Java SE $N is a declaration form (e.g., record type declarations) rather than a statement or expression form, then for any source code that refers to an entity declared using the preview feature, <code>javac</code> issues a suppressible "preview warning" akin to a "deprecation warning". (<code>javac</code> does not record, in the <code>class</code> file emitted for the source code, that the <code>class</code> file <em>depends on a preview VM feature of Java SE $N</em>.) The output of <code>javadoc</code> should highlight where an API refers to an entity declared with the preview feature, and also highlight the preview declaration of the entity itself.</p>
</li>
</ul>
<p>Whether preview language features are enabled or disabled, <code>javac</code> in JDK $N prints a message if it detects the use of a preview language feature of Java SE $N in source code. This message cannot be turned off by using <code>@SuppressWarnings</code> in source code, because developers must be unfailingly aware of their reliance on the Java SE $N version of a preview language feature; the feature may change subtly in Java SE $N+1. The message looks like this:</p>
<pre><code>Note: Some input files use a preview language feature.
Note: Recompile with -Xlint:preview for details.</code></pre>
<p>The off-by-default "preview" analysis suggested by the message provides information about each use of a preview language feature of Java SE $N. Additionally, on a best effort basis, the analysis may provide information about the use of preview language features of other Java SE releases.</p>
<blockquote>
<p>The <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-9.html#jls-9.6.4.6">use of deprecated program elements</a> causes <code>javac</code> to print a similar message, suggesting to <code>Recompile with -Xlint:deprecation for details.</code> However, developers can <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-9.html#jls-9.6.4.5">hide that message</a> by using <code>@SuppressWarnings("deprecation")</code> or <code>@SuppressWarnings("removal")</code>. The suppression of removal warnings, which indicate use of <em>terminally</em> deprecated elements, is discouraged, but it is permitted because the effect of removing such elements in a future Java SE release will be immediately and abundantly clear to developers (their programs will fail to recompile). In contrast, a preview language feature could be changed in a source-compatible but not behaviorally-compatible manner in a future Java SE release; programs which used the feature would recompile successfully, but have a different meaning. In effect, the future of a preview language feature is less predictable than the future of a terminally deprecated program element. Accordingly, the risk of using a preview language feature is higher than the risk of using a terminally deprecated program element, so the warning message for a preview feature is stiffer.</p>
</blockquote>
<p><code>jshell</code> and <code>javadoc</code> in JDK $N support the preview language features of Java SE $N only if <code>--enable-preview</code> is specified at startup.</p>
<p><strong>Run time</strong></p>
<p>The <code>java</code> launcher in JDK $N takes a flag to enable the preview VM features of Java SE $N. This enables execution of any class file that depends on those preview VM features, either because it truly refers to those features or because it was compiled from source code which used preview language features.</p>
<p>On JDK 13:</p>
<pre><code>java Foo                            // Do not enable any preview features
java --enable-preview Foo           // Enable all preview features of Java SE 13
java --enable-preview -jar App.jar  // Enable all preview features of Java SE 13
java --enable-preview -m App        // Enable all preview features of Java SE 13</code></pre>
<p>On JDK 14:</p>
<pre><code>java Foo                            // Do not enable any preview features
java --enable-preview Foo           // Enable all preview features of Java SE 14
java --enable-preview -jar App.jar  // Enable all preview features of Java SE 14
java --enable-preview -m App        // Enable all preview features of Java SE 14</code></pre>
<p>When the preview VM features of Java SE $N are enabled (<code>--enable-preview</code>):</p>
<ul>
<li>
<p>$N must be the Java SE Platform release to which the JVM implementation conforms. Only a JVM implementation which conforms to Java SE $N may support the preview features defined by Java SE $N. (It is extremely unlikely that a JVM implementation for Java SE $N+1 would want to support the preview features defined by Java SE $N.)</p>
</li>
<li>
<p>If a class file's use of a preview VM feature of Java SE $N causes an exception during loading, linking, or execution, then the JVM implementation may indicate that the exception is due to an preview VM feature of Java SE $N.</p>
</li>
</ul>
<p>Whether preview VM features are enabled or not, class files that do not depend on preview VM features are loaded, linked, and executed in the ordinary way.</p>
<p>The JVM implementation in JDK $N has an off-by-default ability to show which loaded classes depend on the preview VM features of Java SE $N. To enable the ability, pass <code>-Xlog:class+preview</code> to the <code>java</code> launcher.</p>
<p><code>javap</code> in JDK $N does not accept the <code>--enable-preview</code> flag. It automatically highlights where a class file depends on preview VM features of Java SE $N. For a class file that depends on preview VM features of an earlier Java SE release, <code>javap</code> in JDK $N makes a best effort to render the preview content.</p>
<h3 id="Relationship-to-Java-SE-APIs">Relationship to Java SE APIs</h3>
<p>A preview language or VM feature in Java SE $N may rely on any API that is final and permanent in Java SE $N-1. For example, if <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/language/catch-multiple.html">multi-catch</a> had been a preview feature, then it could legitimately have relied on the longstanding hierarchy of exception types under <code>java.lang.Throwable</code>.</p>
<p>More interestingly, a preview language or VM feature in Java SE $N will often be co-developed with enhancements to the <code>java.*</code> and <code>javax.*</code> APIs in Java SE $N. Co-developed APIs fall into three buckets:</p>
<ol>
<li>
<p><em>Essential.</em> The API exists because code cannot enjoy the preview feature without it. Such an API lives in <code>java.*</code> and the JLS will refer to it in normative text. For example, <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-14.html#jls-14.14.2">the enhanced-for statement</a> relies on <code>java.lang.Iterable</code>, and <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-14.html#jls-14.20.3">the try-with-resources statement</a> relies on <code>java.lang.AutoCloseable</code>.</p>
</li>
<li>
<p><em>Reflective.</em> The API exists to expose the preview feature in the <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/reflect/package-summary.html">Core Reflection API</a>, <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/invoke/package-summary.html">Method Handle API</a>, <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.compiler/javax/lang/model/package-summary.html">Language Model API</a>, <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.compiler/javax/annotation/processing/package-summary.html">Annotation Processing API</a>, <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.compiler/javax/tools/package-summary.html">Compiler API</a>, or <a href="https://docs.oracle.com/en/java/javase/13/docs/specs/jni/index.html">JNI</a>. Typically, this exposure is only necessary if the preview feature is a declaration form (such as enum types or record types) rather than a statement, expression, or literal form. For example, <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-9.html#jls-9.6.3">repeatable annotation types</a> prompted <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/Class.html#getAnnotationsByType(java.lang.Class)">additional</a> <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/Class.html#getDeclaredAnnotationsByType(java.lang.Class)">methods</a> in <code>java.lang.Class</code>. Reflective APIs live in <code>java.*</code> or <code>javax.*</code> depending on their history. The JLS will not refer to a reflective API in normative text, but may refer to it in non-normative text.</p>
</li>
<li>
<p><em>Convenient.</em> The API is a collection of useful types and methods that promote or assist usage of the preview feature but are not essential for it. The JLS is unlikely to refer to the API in any way. For example, <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/util/stream/package-summary.html">the Streams API</a> is convenient for developers, especially when lambda expressions are given as arguments, but lambda expressions do not technically rely on it.</p>
</li>
</ol>
<p>If a preview language or VM feature does not eventually achieve final and permanent status in the Java SE Platform, then its essential APIs in <code>java.*</code> and its reflective APIs in <code>java.*</code> and <code>javax.*</code> must be removed swiftly. It is important to communicate this possibility when the APIs are introduced, so that developers do not think of them as permanent, unchanging parts of the Java SE Platform. Furthermore, essential APIs are "special" -- they may be useful to broad swathes of Java programs <em>regardless of whether those programs use any preview language features</em> -- and so the use of essential APIs deserves sterner treatment than the use of reflective APIs. For example, if the enhanced-for statement had been a preview feature, then it would have been necessary to sternly warn against general-purpose use of the <code>java.lang.Iterable</code> interface that was essential to co-develop with the statement.</p>
<p>For essential APIs in <code>java.*</code>, this JEP adopts the following policy: ("source code reference to an essential API element" means the element is overridden, invoked, or referenced by name)</p>
<ol>
<li>
<p>The JLS for Java SE $N must enumerate not only <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-1.html#jls-1.5">the preview language features defined by Java SE $N</a>, but also the essential API elements associated with each preview feature.</p>
</li>
<li>
<p>The narrative specification of an essential API element must clearly document the element's impermanent nature and discourage general-purpose use of the element. At the very least, the API developer should write an <code>@preview</code> tag in the element's <code>javadoc</code> comment, as follows:</p>
</li>
</ol>
<p><code>@preview This class/method/field is associated with $FEATURE_NAME, a preview feature of the Java language. Programs can only use this method when preview features are enabled. Preview features may be removed in a future release, or upgraded to permanent features of the Java language.</code></p>
<ol start="3">
<li>
<p>When compiling with preview features <em>disabled</em>, any source code reference to an essential API element associated with a preview feature must generate a compile-time error. An error is justified because a later release might remove the API element or incompatibly change its behavior. An error is also consistent with the treatment of code that uses a preview language feature when preview features are disabled.</p>
</li>
<li>
<p>When compiling with preview features <em>enabled</em>, any source code reference to an essential API element associated with a preview feature must generate a warning. This warning is suppressible with <code>@SuppressWarnings("preview")</code>, unlike the warning given by <code>javac</code> when it detects the use of a preview language feature in source code; the use of an essential API element is considered slightly less severe (and hence suppressible) than the use of a preview language feature.</p>
</li>
</ol>
<p>For reflective APIs in <code>java.*</code> and <code>javax.*</code>, and also for supported JDK APIs such as <code>com.sun.source.tree.*</code>, this JEP recommends that any source code reference should generate a suppressible lint-style warning, whether preview features are enabled or disabled. The narrative specification of a reflective API element should document the element's impermanent nature as follows:</p>
<p><code>@preview This method/field/enum is associated with $FEATURE_NAME, a preview feature of the Java language. Preview features may be removed in a future release, or upgraded to permanent features of the Java language.</code></p>
<blockquote>
<p>An earlier version of this JEP proposed to use the deprecation mechanism for flagging APIs associated with preview features. Consequently, in Java SE 12 and 13, the APIs associated with preview features were terminally deprecated at birth, that is, annotated with <code>@Deprecated(forRemoval=true, since=...)</code> when they were introduced. For example, Java SE 13 declared an <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/String.html#stripIndent()">essential API associated with text blocks</a>, and a <a href="https://docs.oracle.com/en/java/javase/13/docs/api/jdk.compiler/com/sun/source/tree/SwitchExpressionTree.html">reflective API associated with switch expressions</a>. However, the deprecation-based approach was eventually dropped because it was confusing to see an API element introduced in the same Java SE release as it was deprecated, that is, to see <code>@since 13</code> and <code>@Deprecated(forRemoval=true, since="13")</code> on the same API element.</p>
</blockquote>
<h3 id="Relationship-to-Incubating-APIs">Relationship to Incubating APIs</h3>
<p>An <a href="//openjdk.java.net/jeps/11#Goals">incubating API</a> is an API of non-trivial size that is under development for eventual inclusion in the Java SE Platform or the JDK, but is not yet sufficiently proven.</p>
<p>A preview language or VM feature must not rely on an incubating API, since the API is not part of the Java SE Platform. For example, if a preview language feature was to expand the <code>throw</code> and <code>catch</code> statements to support a third kind of exception class (alongside <a href="https://docs.oracle.com/javase/specs/jls/se9/html/jls-11.html#jls-11.1.1-110">the checked exception classes and the unchecked exception classes</a>), then it would not be appropriate for the root class of this new kind (i.e., the analog of <code>java.lang.Exception</code> and <code>java.lang.RuntimeException</code>) to reside in an incubating API.</p>
<p>A preview language or VM feature may be associated informally with an incubating API that is offered for developer convenience, perhaps as an alternative to the <em>convenient</em> <code>java.*</code> APIs described above. For example, if a preview language feature introduced multi-line string literals, then it may be advertised alongside new string-processing methods (e.g., to strip newlines, adjust indentation, etc) which reside in the <code>jdk.incubator.strings</code> package long before they are committed to the <code>java.lang.String</code> class.</p>
<p>The implementation of a preview language feature by <code>javac</code>, or the implementation of a preview VM feature by HotSpot, may rely on incubating APIs. For example, if <code>javac</code> implements multi-line strings (a preview language feature) by storing them in a new kind of constant pool entry (a preview VM feature), then <code>javac</code> may emit class files whose bytecode retrieves multi-line strings by invoking methods in the package <code>jdk.incubator.strings.classfile</code> (an incubating API). As a convenience to developers, the incubator module which contains this package would be resolved automatically when the <code>--enable-preview</code> flag is passed to <code>javac</code> or the <code>java</code> launcher.</p>
<p>It is conceivable that the implementation of a preview language or VM feature could rely on an incubating API whose own implementation relies on a different preview language or VM feature; implementers may have to collaborate in order to avoid circularity.</p>
<h3 id="Process-issues">Process issues</h3>
<p>In the <a href="//cr.openjdk.java.net/~mr/jep/jep-2.0-02.html">JEP Process</a>, every new language and VM feature is drafted as a JEP and moves through various phases of candidacy and endorsement before being integrated into a JDK feature release. It is envisaged that a JEP can be drafted, reviewed, endorsed, submitted, and have development work start without regard to whether the feature will be integrated as a preview feature. This affirms, for a given release of the Java SE Platform, that the technical quality of a preview feature is equal to that of a final and permanent feature.</p>
<p>In other words, previewing should not be top of mind when a feature is designed and developed. Still, at some point, a JEP owner may warm to the idea of making the feature available on a preview basis. The owner is free to discuss the implications in the JEP, such as the possibility of the feature being previewed and later removed. (This would be especially appropriate in the somewhat risky situation where the feature relies on new <code>java.*</code> APIs, since user code can refer to them despite strong advice not to. If feedback is likely to cause changes to the APIs, or if they are so attractive that their use will spread far beyond the preview feature, then the owner should consider if previewing is really appropriate.) The owner is also free to reflect previewing in the feature's implementation (such as the choice of package names for internal classes) and in related processes (such as <a href="//openjdk.java.net/groups/csr/">compatibility review</a>).</p>
<p>The formal step to preview availability occurs when the JEP reaches Proposed To Target status. At that time, the JEP owner must state if they wish the feature to be available as a preview in the proposed release. If and when the JEP reaches Targeted status, it must be flagged as a preview feature by having "(Preview)" appended to its title, e.g., "JEP 326: Raw String Literals (Preview)". The preview feature will be listed alongside permanent features in the Specification of the Java SE Platform, e.g., see the feature descriptions for <a href="//cr.openjdk.java.net/~iris/se/12/latestSpec/#Feature-summary">Java SE 12</a>). After the JEP is Targeted, it cannot easily change from preview to permanent, or vice versa; it must return to Candidate status first.</p>
<p>After a preview feature's code has been integrated into JDK $N, the JEP is closed as usual. Much evangelism lies ahead for the JEP owner! The technique or channel by which the owner requests or receives feedback from developers is left to the discretion and experience of the JEP owner. Given the fast six-month cadence for JDK feature releases, it is completely acceptable for the JEP owner to re-preview the feature in JDK $N+1 to gain further feedback; in this case, they should file a new JEP for JDK $N+1 to indicate this intent.</p>
<p>Eventually, the JEP owner must decide the preview feature's fate. If the decision is to remove the preview feature, then the owner should file an issue in JBS to remove the feature in the next JDK feature release; no new JEP is needed. On the other hand, if the decision is to finalize, then the owner should file a new JEP, noting refinements informed by developer feedback; this JEP will ultimately reach Targeted status for the next JDK feature release.</p>
<h2 id="Alternatives">Alternatives</h2>
<p>A <code>class</code> file could denote that it depends on the preview VM feature of Java SE $N <em>even if nothing in the <code>class</code> file truly does</em>. This would typically occur if source code uses a preview language feature that "compiles away"; if not for the <code>minor_version</code> item of 65535, the <code>class</code> file could be executed on a JVM implementation for Java SE $N in the ordinary way. An alternative approach would be less strict: require a <code>class</code> file to denote that it depends on preview VM features only if something in the <code>class</code> file truly does. (This could be coupled with a run-time check that <code>class</code> files with a <code>minor_version</code> of 65535 genuinely do use preview VM features and/or APIs connected with preview features.) However, such <code>class</code> files could be widely distributed and executed for many years, long after the preview language feature is changed or removed. This is undesirable because the developer has no motivation to re-code to avoid the preview language feature; they can treat it as effectively final and permanent.</p>
<p>The <a href="//openjdk.java.net/projects/jdk/">JDK Project</a> could publish Early Access (EA) binaries during stabilization of the release, prior to General Availability (GA). EA binaries may give new features the broad exposure necessary to provoke useful feedback. If refinements could be designed, specified, and implemented prior to GA, then there would be no need to preview the features in a GA release. Historically, however, EA binaries have not been widely downloaded and tested by developers at large; this is likely to be even more true when GA releases occur every six months.</p>
<p>In some cases, project-specific EA binaries are a plausible carrier for features that need feedback:</p>
<ul>
<li>
<p>when the feature is not yet of the technical quality required for inclusion in a GA release of the JDK Project;</p>
</li>
<li>
<p>when the target audience of the EA binaries is small or heavily focused on the project, and the high visibility of a GA release is not yet desired;</p>
</li>
<li>
<p>when preview features are somehow pervasive and thus difficult to factor as separately packaged APIs, isolated language features, or discrete VM mechanisms.</p>
</li>
</ul>
<p>A different way to include disabled features in a GA release is to hide them behind existing flags for conditional behavior. These include <a href="https://bugs.openjdk.java.net/browse/JDK-8189145">-Xlint:future in javac</a> and <a href="https://docs.oracle.com/javase/9/tools/java.htm#GUID-3B1CE181-CD30-4178-9602-230B800D4FAE__GUID-5D19634F-82FC-4646-88CF-228C5A5EB58D">-Xfuture in HotSpot</a>. Alternatively, source code which uses an preview language feature could have an annotation on the class or method declaration to indicate that <code>javac</code> should enable the preview feature automatically. (One benefit of this local, source-driven scheme is that the annotation could denote which Java SE release included the preview feature. Later versions of <code>javac</code> would refuse to compile the code, avoiding the problem where the feature's semantics, but not syntax, changed after preview and would thus "silently" modify the meaning of the code.)</p>
<h2 id="Risks-and-Assumptions">Risks and Assumptions</h2>
<p>Under the <a href="https://mreinhold.org/blog/forward-faster#Proposal">six-month cadence</a>, a language or VM feature which "misses the train" has only a short wait before the chance to catch the next one. The decision to preview a language or VM feature means including the feature in the stabilization branch, so the train has been caught, yet the final and permanent feature is not truly on board. This could cause confusion. Worse, it might tempt a feature owner who is in danger of missing the train to label their feature as a preview in order to catch it.</p>
<p>It is assumed that the time frame for feedback on a preview language or VM feature (typically six months, but more if it re-previews) is sufficient to allow non-trivial course corrections. However, because exploiting new language features can demand substantial refactoring of existing programs, the time frame may not be sufficient for thorough exploration by developers.</p>
</div></div><div id="sidebar"><div id="openjdk-sidebar-logo"><a href="/"><img alt="OpenJDK logo" src="/images/openjdk-small.png" /></a></div><div class="links"><div class="links"><a href="/workshop"><b>Workshop</b></a></div></div><div class="links"><div class="link"><a href="/faq/">OpenJDK FAQ</a></div><div class="link"><a href="/install/">Installing</a></div><div class="link"><a href="/contribute/">Contributing</a></div><div class="link"><a href="/sponsor/">Sponsoring</a></div><div class="link"><a href="/guide/">Developers' Guide</a></div><div class="link"><a href="/groups/vulnerability/report">Vulnerabilities</a></div></div><div class="links"><div class="links"><a href="//mail.openjdk.java.net">Mailing lists</a></div><div class="link"><a href="/irc">IRC</a>
                      &#183; <a href="https://wiki.openjdk.java.net">Wiki</a></div></div><div class="links"><div class="links"><a href="/bylaws">Bylaws</a> &#183; <a href="/census">Census</a></div><div class="link"><a href="/legal/">Legal</a></div></div><div class="links"><div class="links"><a href="/jeps/0"><b>JEP Process</b></a></div></div><div class="links"><div class="link search"><form method="get" action="https://www.google.com/search"><input id="searchBox" style="color: gray" type="text" name="q" size="10" maxlength="255" value="search" /><input type="hidden" name="sitesearch" value="openjdk.java.net" /></form></div></div><div class="links"><div class="about">Source code</div><div class="link"><a href="//hg.openjdk.java.net">Mercurial</a></div><div class="link">Bundles (<a href="http://download.java.net/openjdk/jdk6">6</a>)</div></div><div class="links"><div class="about">Groups</div><div class="link"><a href="/groups/">(overview)</a></div><div class="link"><a href="/groups/2d">2D Graphics</a></div><div class="link"><a href="/groups/adoption">Adoption</a></div><div class="link"><a href="/groups/awt">AWT</a></div><div class="link"><a href="/groups/build">Build</a></div><div class="link"><a href="/groups/csr">Compatibility &amp; Specification Review</a></div><div class="link"><a href="/groups/compiler">Compiler</a></div><div class="link"><a href="/groups/conformance">Conformance</a></div><div class="link"><a href="/groups/core-libs">Core Libraries</a></div><div class="link"><a href="/groups/gb">Governing Board</a></div><div class="link"><a href="/groups/hotspot">HotSpot</a></div><div class="link"><a href="/groups/ide-support">IDE Tooling &amp; Support</a></div><div class="link"><a href="/groups/i18n">Internationalization</a></div><div class="link"><a href="/groups/jmx">JMX</a></div><div class="link"><a href="/groups/members">Members</a></div><div class="link"><a href="/groups/net">Networking</a></div><div class="link"><a href="/groups/nb-projects">NetBeans Projects</a></div><div class="link"><a href="/groups/porters">Porters</a></div><div class="link"><a href="/groups/quality">Quality</a></div><div class="link"><a href="/groups/security">Security</a></div><div class="link"><a href="/groups/serviceability">Serviceability</a></div><div class="link"><a href="/groups/sound">Sound</a></div><div class="link"><a href="/groups/swing">Swing</a></div><div class="link"><a href="/groups/vulnerability">Vulnerability</a></div><div class="link"><a href="/groups/web">Web</a></div></div><div class="links"><div class="about">Projects</div><div class="link"><a href="/projects/">(overview)</a></div><div class="link"><a href="/projects/amber">Amber</a></div><div class="link"><a href="/projects/anno-pipeline">Annotations Pipeline 2.0</a></div><div class="link"><a href="/projects/audio-engine">Audio Engine</a></div><div class="link"><a href="/projects/build-infra">Build Infrastructure</a></div><div class="link"><a href="/projects/caciocavallo">Caciocavallo</a></div><div class="link"><a href="/projects/closures">Closures</a></div><div class="link"><a href="/projects/code-tools">Code Tools</a></div><div class="link"><a href="/projects/coin">Coin</a></div><div class="link"><a href="/projects/cvmi">Common VM Interface</a></div><div class="link"><a href="/projects/compiler-grammar">Compiler Grammar</a></div><div class="link"><a href="/projects/detroit">Detroit</a></div><div class="link"><a href="/projects/dio">Device I/O</a></div><div class="link"><a href="/projects/duke">Duke</a></div><div class="link"><a href="/projects/font-scaler">Font Scaler</a></div><div class="link"><a href="/projects/fbtoolkit">Framebuffer Toolkit</a></div><div class="link"><a href="/projects/graal">Graal</a></div><div class="link"><a href="/projects/graphics-rasterizer">Graphics Rasterizer</a></div><div class="link"><a href="/projects/harfbuzz">HarfBuzz Integration</a></div><div class="link"><a href="/projects/icedtea">IcedTea</a></div><div class="link"><a href="/projects/jdk6">JDK 6</a></div><div class="link"><a href="/projects/jdk7">JDK 7</a></div><div class="link"><a href="/projects/jdk7u">JDK 7 Updates</a></div><div class="link"><a href="/projects/jdk8">JDK 8</a></div><div class="link"><a href="/projects/jdk8u">JDK 8 Updates</a></div><div class="link"><a href="/projects/jdk9">JDK 9</a></div><div class="link"><a href="/projects/jdk">JDK</a>
      (&#8230;
       <a href="/projects/jdk/12">12</a>,
       <a href="/projects/jdk/13">13</a>,
       <a href="/projects/jdk/14">14</a>)</div><div class="link"><a href="/projects/jdk-updates">JDK Updates</a></div><div class="link"><a href="/projects/javadoc-next">JavaDoc.Next</a></div><div class="link"><a href="/projects/jigsaw">Jigsaw</a></div><div class="link"><a href="/projects/kona">Kona</a></div><div class="link"><a href="/projects/kulla">Kulla</a></div><div class="link"><a href="/projects/lambda">Lambda</a></div><div class="link"><a href="/projects/lanai">Lanai</a></div><div class="link"><a href="/projects/locale-enhancement">Locale Enhancement</a></div><div class="link"><a href="/projects/loom">Loom</a></div><div class="link"><a href="/projects/jmm">Memory Model Update</a></div><div class="link"><a href="/projects/metropolis">Metropolis</a></div><div class="link"><a href="/projects/jmc">Mission Control</a></div><div class="link"><a href="/projects/mobile">Mobile</a></div><div class="link"><a href="/projects/modules">Modules</a></div><div class="link"><a href="/projects/mlvm">Multi-Language VM</a></div><div class="link"><a href="/projects/nashorn">Nashorn</a></div><div class="link"><a href="/projects/nio">New I/O</a></div><div class="link"><a href="/projects/openjfx">OpenJFX</a></div><div class="link"><a href="/projects/panama">Panama</a></div><div class="link"><a href="/projects/penrose">Penrose</a></div><div class="link"><a href="/projects/aarch32-port">Port: AArch32</a></div><div class="link"><a href="/projects/aarch64-port">Port: AArch64</a></div><div class="link"><a href="/projects/bsd-port">Port: BSD</a></div><div class="link"><a href="/projects/haiku-port">Port: Haiku</a></div><div class="link"><a href="/projects/macosx-port">Port: Mac OS X</a></div><div class="link"><a href="/projects/mips-port">Port: MIPS</a></div><div class="link"><a href="/projects/ppc-aix-port">Port: PowerPC/AIX</a></div><div class="link"><a href="/projects/s390x-port">Port: s390x</a></div><div class="link"><a href="/projects/portola">Portola</a></div><div class="link"><a href="/projects/sctp">SCTP</a></div><div class="link"><a href="/projects/skara">Skara</a></div><div class="link"><a href="/projects/shenandoah">Shenandoah</a></div><div class="link"><a href="/projects/sumatra">Sumatra</a></div><div class="link"><a href="/projects/threeten">ThreeTen</a></div><div class="link"><a href="/projects/tiered-attrib">Tiered Attribution</a></div><div class="link"><a href="/projects/tsan">Tsan</a></div><div class="link"><a href="/projects/type-annotations">Type Annotations</a></div><div class="link"><a href="/projects/xrender">XRender Pipeline</a></div><div class="link"><a href="/projects/valhalla">Valhalla</a></div><div class="link"><a href="/projects/verona">Verona</a></div><div class="link"><a href="/projects/visualvm">VisualVM</a></div><div class="link"><a href="/projects/zero">Zero</a></div><div class="link"><a href="/projects/zgc">ZGC</a></div></div><div class="links"><div class="about">Tools</div><div class="link"><a href="http://java.sun.com/javase/downloads/index.jsp">Java SE</a></div><div class="link"><a href="http://mercurial-scm.org/mercurial/">Mercurial</a></div><div class="link"><a href="/jtreg/index.html">jtreg harness</a></div></div><div class="links"><div class="about">Related</div><div class="link"><a href="http://planetjdk.org">Planet JDK</a></div><div class="link"><a href="http://java.sun.com">java.sun.com</a></div><div class="link"><a href="http://jcp.org">Java Community Process</a></div><div class="link"><a href="//jdk.java.net">JDK GA/EA Builds</a></div></div><div class="buttons"><a href="http://oracle.com"><img alt="Oracle logo" src="/images/oracle.png" /></a></div></div><div id="footer">

        &#169; 2019 Oracle Corporation and/or its affiliates
        <br /><a href="/legal/tou/">Terms of Use</a>
        &#183;
        
            License: <a href="/legal/gplv2+ce.html">GPLv2</a>
        &#183; <a href="http://www.oracle.com/us/legal/privacy/">Privacy</a>
        &#183; <a href="http://www.oracle.com/us/legal/third-party-trademarks/third-party-trademarks-078568.html">Trademarks</a></div><SCRIPT type="text/javascript">
  var sc_project=2527440;
  var sc_invisible=1;
  var sc_partition=24;
  var sc_security="d832a704";
  var sc_remove_link=1;
  </SCRIPT><script type="text/javascript" src="https://www.statcounter.com/counter/counter_xhtml.js" async="yes"></script><noscript><div class="statcounter"><img class="statcounter" src="https://c.statcounter.com/2527440/0/d832a704/1/" alt="web statistics" /></div></noscript></body></html>
